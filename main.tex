\documentclass{minimal}
\usepackage[a0paper,landscape,margin=0mm]{geometry}

\usepackage{xcolor}
\pagecolor{black}

\usepackage{calc}

\usepackage{xstring}

\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{shapes.multipart}

\usepackage{fontspec}
\setmainfont{Linux Libertine O}
\newfontface\kanjiFont{HanWang KaiBold-Gb5}

\newlength\pagepadding  \setlength\pagepadding{\paperheight/150} % */(64+1)/2
\newlength\bannerheight \setlength\bannerheight{\paperheight-2\pagepadding}
\newlength\bannerwidth  \setlength\bannerwidth{(\paperwidth-2\pagepadding)/9}
\newlength\gridheight   \setlength\gridheight{\paperheight-2\pagepadding}
\newlength\gridwidth    \setlength\gridwidth{\paperwidth-\bannerwidth-2\pagepadding}
\newlength\cellheight   \setlength\cellheight{\gridheight/8}
\newlength\cellwidth    \setlength\cellwidth{\gridwidth/8}
\newlength\cellpadding  \setlength\cellpadding{\cellheight/16} % */8/2
\newlength\cellcolumn   \setlength\cellcolumn{(\cellwidth-3\cellpadding)/2}
\newlength\thickness    \setlength\thickness{\cellheight/8}

\def\bigKanjiFont{\fontsize{100}{120}\kanjiFont}
\def\smallKanjiFont{\fontsize{80}{96}\kanjiFont}

\def\judgmentFont{\fontsize{8.3pt}{10pt}\selectfont}
\def\imageFont{\itshape\fontsize{8.3pt}{10pt}\selectfont}
\def\commentFont{\fontsize{6pt}{8.3pt}\selectfont}

\def\bigCommentFont{\fontsize{6.9pt}{8.3pt}\selectfont}
\def\smallCommentFont{\fontsize{5pt}{6pt}\selectfont}

\newcommand\formatIdeogram[1]{%
  \StrChar{#1}{1}[\fst]%
  \StrChar{#1}{2}[\snd]%
  \IfStrEq{}{\snd}
    {\bigKanjiFont\fst}
    {\smallKanjiFont\fst\\\snd}}

\newcommand\commentFontSelector[1]{%
  \setbox0\hbox to \cellcolumn{\vbox{\bigCommentFont#1}}%
  \ifdim\ht0>\thickness\smallCommentFont\else\bigCommentFont\fi}





\usepackage{etoolbox}



\input{iching}
\def\cs#1{\csname#1\endcsname}

\tikzset{ shorten <>/.style={ shorten >=#1, shorten <=#1 } }

\tikzset{pics/.cd,
  monogram/.style args={#1 over #2}{code={
    \begin{scope}
      [ black!80!white
      , line width = \thickness
      , line cap = round
      , shorten <> = 3.14*\thickness/8 % area optical correction
      , xscale = \cellcolumn/1cm
      ]
    \IfStrEq{#2}{:}
      {\draw (0,0) -- (1/3,0); \draw (2/3,0) -- (1,0);} % : yin
      {\draw (0,0)              --              (1,0);} % | yang
    \end{scope}
    \node [ text width = \cellcolumn
          %, inner sep = 0.5cm 
          , font = \commentFontSelector{#1}
          , align = center
          , white
          ] at (\cellcolumn/2,0) {#1};
  }},
  hexagram/.style args={#1}{code={
    \foreach \n in {1,...,6}{
      \pic [yshift=1.2*(\n-3.5)*\thickness]
           {monogram = \cs{hexagram#1/line\n/comment} %
                  over \cs{hexagram#1/line\n/side}};}
  }},
  hexamino/.style args={#1}{code={
    \node [ %draw
          , %black!95!white
          , rectangle
          , minimum width  = \cellwidth  - 2*\cellpadding
          , minimum height = \cellheight - 2*\cellpadding
          ] (bound) {#1};
    \node [ %draw
          , rectangle split
          , rectangle split parts = 2
          , anchor = north east
          , text width = \cellcolumn
          , align = center
          ] at (bound.north east)
          {\formatIdeogram{\cs{hexagram#1/ideogram}}%
           \nodepart{two}\fontsize{10}{0}\selectfont%
           \cs{hexagram#1/translitteration}};
    \node [ %draw
          , text width = \cellcolumn
          , rectangle
          , anchor = south east
          , align = justify
          , font = \judgmentFont
          ] (judgment) at (bound.south east)
          {\cs{hexagram#1/judgment}};
    \node [ %draw
          , text width = \cellcolumn
          , rectangle
          , anchor = south
          , align = justify
          , font = \imageFont
          ] at (judgment.north)
          {\cs{hexagram#1/image}};
    \pic at (bound.west) {hexagram/.expand once=#1};
  }},
  banner/.style args={#1}{code={
    %\draw (0,0) rectangle (\bannerwidth,-\bannerheight);
    \node [ %draw
          , rectangle split
          , rectangle split parts = 2
          , rectangle split part align = {center, center}
          , font = \fontsize{250}{0}\selectfont\kanjiFont
          ] at (\bannerwidth/2,-\bannerheight/8)
          {易\nodepart{two}經};
  }}
}

\begin{document}\topskip=0pt\noindent%
  \begin{tikzpicture}[remember picture, overlay, color=white]
    \fill (0,0) circle (5pt);
    \draw [purple]
      (current page.south east) circle (20pt)
      (current page.north east) circle (20pt)
      (current page.north west) circle (20pt)
      (current page.south west) circle (20pt);
    \foreach [count=\n] \x in {0,...,63}{
      \pic at ( { (mod(\x,8)+0.5)/8*\gridwidth+\pagepadding}
              , {-(int(\x/8)+0.5)/8*\gridheight-\pagepadding}
              ) {hexamino=\n};
    }
    \pic at ({\gridwidth+\pagepadding},{-\pagepadding}) {banner=no};
  \end{tikzpicture}
\end{document}
